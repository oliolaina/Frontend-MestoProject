(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,o,n){var r=e.querySelector(".places__item").cloneNode(!0),c=r.querySelector(".card__image"),a=r.querySelector(".card__title"),u=(r.querySelector(".card__delete-button"),r.querySelector(".card__like-button"),r.querySelector(".like_counter"));return a.textContent=t,c.setAttribute("src",o),c.setAttribute("alt",t.toLowerCase()),u.textContent=n,r}function o(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(o):t.classList.add(o)}function n(e){i(e.target)}function r(){document.querySelector(".popup_is-opened").addEventListener("click",n)}function c(){document.querySelector(".popup_is-opened").removeEventListener("click",n)}function a(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function u(e){var t=e.querySelector(".popup__content");e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),e.addEventListener("click",n),t.addEventListener("mouseleave",r),t.addEventListener("mouseenter",c)}function i(e){var t=e.querySelector(".popup__content");e.classList.remove("popup_is-opened"),e.removeEventListener("click",n),t.removeEventListener("mouseleave",r),t.removeEventListener("mouseenter",c),document.removeEventListener("keydown",a)}var s=document.querySelector(".popup_type_image"),l=s.querySelector(".popup__image"),d=s.querySelector(".popup__close"),p=document.querySelector(".popup__caption");d.addEventListener("click",(function(){i(s)}));var _=document.querySelector(".popup_type_edit"),f=_.querySelector(".popup__form"),v=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),y=document.querySelector(".popup__input_type_name"),m=document.querySelector(".popup__input_type_description"),h=document.querySelector(".profile__edit-button"),S=_.querySelector(".popup__close");h.addEventListener("click",(function(){y.value=v.textContent,m.value=b.textContent,u(_)})),S.addEventListener("click",(function(){i(_)})),f.addEventListener("submit",(function(e){e.preventDefault(),_.querySelector(".popup__button").textContent="Сохранение...",v.textContent=y.value,b.textContent=m.value,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"PATCH",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3","Content-Type":"application/json"},body:JSON.stringify({name:y.value,about:m.value})}).then(i(_)).finally(_.querySelector(".popup__button").textContent="Сохранить").catch((function(e){console.error("Error fetching cards:",e)}))}));var q,L=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),E=document.querySelector(".places__list"),g=document.querySelector(".popup_type_new-card"),C=document.querySelector(".profile__add-button"),x=g.querySelector(".popup__close"),T=g.querySelector(".popup__form");C.addEventListener("click",(function(){L.value="",k.value="",u(g)})),x.addEventListener("click",(function(){i(g)})),T.addEventListener("submit",(function(e){e.preventDefault(),g.querySelector(".popup__button").textContent="Сохранение...";var o,n,r=t(L.value,k.value,0);E.prepend(r),o=L.value,n=k.value,fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"POST",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3","Content-Type":"application/json"},body:JSON.stringify({name:o,link:n})}).then(i(g)).catch((function(e){console.error("Error fetching cards:",e)})),g.querySelector(".popup__button").textContent="Сохранить",console.log("card added: ",L.value,k.value)})),E.addEventListener("click",(function(e){e.target.classList.contains("card__image")&&(l.setAttribute("src",""),l.setAttribute("src",e.target.src),p.textContent=e.target.alt,u(s))})),_.classList.add("popup_is-animated"),g.classList.add("popup_is-animated"),s.classList.add("popup_is-animated"),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_type_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o(n,r,t.inactiveButtonClass),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o,n){console.log("1"),t.validity.valid?function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",t.classList.remove(o),r.classList.remove(n)}(e,t,o,n):function(e,t,o,n,r){var c=e.querySelector(".".concat(t.id,"-error"));c.textContent=o,t.classList.add(n),c.classList.add(r)}(e,t,t.validationMessage,o,n)}(e,c,t.inputErrorClass,t.errorClass),o(n,r,t.inactiveButtonClass)}))}))}(e,q)}));var z=document.querySelector(".profile__image"),A=document.querySelector(".avatar_svg"),j=document.querySelector(".avatar_black");z.addEventListener("mouseover",(function(e){A.classList.add("avatar_hover"),A.classList.add("unhidden"),j.style.display="block"})),z.addEventListener("mouseout",(function(e){A.classList.remove("avatar_hover"),A.classList.remove("unhidden"),j.style.display="none"}));var N=document.querySelector(".popup_type_avatar");N.classList.add("popup_is-animated");var w=document.querySelector(".button_avatar");w.style.border="unset",w.style.reset="all",w.style.cursor="pointer",w.style.background="black";var B=N.querySelector(".popup__close"),D=N.querySelector(".popup__form"),O=N.querySelector(".popup__input_type_avatar");w.addEventListener("click",(function(e){u(N)})),B.addEventListener("click",(function(e){i(N)})),D.addEventListener("submit",(function(e){e.preventDefault(),N.querySelector(".popup__button").textContent="Сохранение...";var t=O.value;z.style.background="url(".concat(t,")"),z.style.backgroundSize="contain",z.style.objectFit="contain",fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me/avatar",{method:"PATCH",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(N.querySelector(".popup__input_type_avatar").value="").then(i(N)).finally(N.querySelector(".popup__button").textContent="Сохранить").catch((function(e){console.error("Error changing avatar:",e)}))})),fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/users/me",{method:"GET",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){return console.log("user ",e),e})).then((function(e){v.textContent=e.name,b.textContent=e.about,z.style.background="url(".concat(e.avatar,")"),z.style.objectFit="contain",z.style.backgroundSize="contain",console.log("Данные успешно установлены")})).catch((function(e){console.error("Error fetching profile info:",e)})),fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards",{method:"GET",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){return console.log("uploaded Cards ",e),e})).then((function(e){return e.forEach((function(e){var o=t(e.name,e.link,e.likes.length);o.querySelector(".card__like-button").addEventListener("click",(function(t){t.target.classList.contains("card__like-button_is-active")?(fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"DELETE",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3"}}).catch((function(e){console.error("Error liking:",e)})),o.querySelector(".card__like-button").classList.remove("card__like-button_is-active"),o.querySelector(".like_counter").textContent=Number(o.querySelector(".like_counter").textContent)-1):(fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/likes/".concat(e._id),{method:"PUT",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3"}}).then((function(e){return e.json()})).then((function(e){return console.log("like added",e)})).catch((function(e){console.error("Error liking:",e)})),o.querySelector(".card__like-button").classList.add("card__like-button_is-active"),o.querySelector(".like_counter").textContent=Number(o.querySelector(".like_counter").textContent)+1)})),"d426b35ac965be93458533cb"!==e.owner._id?o.querySelector(".card__delete-button").classList.add("hidden"):o.querySelector(".card__delete-button").addEventListener("click",(function(t){fetch("https://nomoreparties.co/v1/frontend-st-cohort-201/cards/".concat(e._id),{method:"DELETE",headers:{authorization:"b75e38fb-2f74-4b94-a5ec-aabb6cb501f3"}}).then((function(e){return o.classList.add("hidden")})).catch((function(e){console.error("Error deleting card:",e)}))})),e.likes.some((function(e){return"d426b35ac965be93458533cb"==e._id}))&&o.querySelector(".card__like-button").classList.add("card__like-button_is-active"),E.append(o)})),e})).catch((function(e){console.error("Error fetching cards:",e)}))})();